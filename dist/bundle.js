(()=>{"use strict";class t{data;compare;constructor(t){this.data=[],this.compare=t||function(t,e){return t-e}}push(t){const e=this.data.length;this.data[e]=t,this.shiftUp(e)}peek(){return this.data[0]}pop(){if(this.data.length<=1)return this.data.shift();const t=this.data[0],e=this.data.pop();return void 0!==e&&t!==e?(this.data[0]=e,this.shiftDown(0),t):t}shiftUp(t){for(;t>0;){const s=t>>>1,i=this.data[s],o=this.data[t];if(!(this.compare(i,o)>0))return;e(this.data,t,s),t=s}}shiftDown(t){const s=this.data.length,i=(s>>>1)-1;for(;t<=i;){const i=2*(t+1)-1,o=i+1,a=this.data[t],n=this.data[i],r=this.data[o];if(this.compare(a,n)>0)o<s&&this.compare(n,r)>0?(e(this.data,t,o),t=o):(e(this.data,t,i),t=i);else{if(!(o<s&&this.compare(a,r)>0))return;e(this.data,t,o),t=o}}}show(){const t=this.data;return t&&0!==t.length?function e(s,i,o){if(s>=t.length||null===t[s]||void 0===t[s])return"";const a=t[s],n=2*s+1;let r="";return r+=e(2*s+2,i+1,o+6),r+=" ".repeat(o)+a+"\n",r+=e(n,i+1,o+6),r}(0,0,0):""}toString=this.show;toJSON=this.show;valueOf=this.show}function e(t,e,s){const i=t[e];t[e]=t[s],t[s]=i}const s=(t,e)=>{const s=t.expirationTime-e.expirationTime;return 0!==s?s:t.id-e.id};var i;!function(t){t.IMMEDIATE_PRIORITY="IMMEDIATE_PRIORITY",t.USER_BLOCKING_PRIORITY="USER_BLOCKING_PRIORITY",t.NORMAL_PRIORITY="NORMAL_PRIORITY",t.LOW_PRIORITY="LOW_PRIORITY",t.IDLE_PRIORITY="IDLE_PRIORITY"}(i||(i={}));const o={[i.IMMEDIATE_PRIORITY]:-1,[i.USER_BLOCKING_PRIORITY]:250,[i.NORMAL_PRIORITY]:500,[i.LOW_PRIORITY]:1e3,[i.IDLE_PRIORITY]:Number.MAX_SAFE_INTEGER};new class{taskQueue=new t(s);timerQueue=new t(s);userTaskCnt=0;isMessageLoopRunning=!1;isHostCallbackScheduled=!1;isPerformingWork=!1;isHostTimeoutScheduled=!1;timerId=void 0;scheduleCallback(t=i.NORMAL_PRIORITY,e=()=>{},s=0){const a=performance.now(),n=a+s,r=n+(o[t]||o[i.NORMAL_PRIORITY]),h={id:this.userTaskCnt++,priorityLevel:t,startTime:n,expirationTime:r,callback:e,sortIndex:-1};n>a?(h.sortIndex=n,this.timerQueue.push(h),this.timerQueue.peek()===h&&(this.cancelHostTimeout(),this.requestHostTimeout(this.handleTimeout,h.startTime-performance.now()))):(h.sortIndex=r,this.taskQueue.push(h),this.isHostCallbackScheduled||this.isPerformingWork||(this.isHostCallbackScheduled=!0,this.requestHostCallback()))}requestHostCallback(){this.isMessageLoopRunning||(this.isMessageLoopRunning=!0,this.schedulePerformWorkUntilDeadline())}advacneTimers(){}handleTimeout(){if(this.isHostTimeoutScheduled=!1,this.advacneTimers(),!this.isHostTimeoutScheduled)if(this.taskQueue.peek())this.isHostTimeoutScheduled=!0,this.requestHostCallback();else{const t=this.timerQueue.peek();t&&this.requestHostTimeout(this.handleTimeout,t.startTime-performance.now())}}requestHostTimeout(t,e){this.isHostTimeoutScheduled||(this.isHostTimeoutScheduled=!0,this.timerId=setTimeout(t,e))}cancelHostTimeout(){this.isHostTimeoutScheduled&&(clearTimeout(this.timerId),this.timerId=void 0,this.isHostTimeoutScheduled=!1)}performWorkUntilDeadline(){if(this.isMessageLoopRunning){const t=performance.now();let e=!0;try{e=this.flushWork(t)}finally{e?this.schedulePerformWorkUntilDeadline():this.isMessageLoopRunning=!1}}}schedulePerformWorkUntilDeadline(){if("function"==typeof MessageChannel){const t=new MessageChannel;t.port2.onmessage=this.performWorkUntilDeadline.bind(this),t.port1.postMessage(null)}else setTimeout((()=>{this.performWorkUntilDeadline()}))}flushWork(t){this.isHostCallbackScheduled=!1,this.cancelHostTimeout(),this.isPerformingWork=!0;try{return this.workLoop(t)}finally{this.isPerformingWork=!1}}workLoop(t){let e=t;this.advacneTimers();let s=this.taskQueue.peek(),i=!1;for(;s&&(i=s.expirationTime<e,i||!this.shouldYieldHost(t));){const t=s.callback;if(s.callback=null,"function"==typeof t){const e=t(i);if("function"==typeof e)return s.callback=e,this.advacneTimers(),!0;s===this.taskQueue.peek()&&this.taskQueue.pop(),this.advacneTimers()}else this.taskQueue.pop();s=this.taskQueue.peek()}if(s)return!0;if(this.timerQueue.peek()){const t=this.timerQueue.peek();t&&this.requestHostTimeout(this.handleTimeout,t.startTime-performance.now())}return!1}shouldYieldHost(t){return performance.now()-t>5}}})();
var e={d:(t,i)=>{for(var s in i)e.o(i,s)&&!e.o(t,s)&&Object.defineProperty(t,s,{enumerable:!0,get:i[s]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)},t={};e.d(t,{J:()=>o,A:()=>a});class i{data;compare;constructor(e){this.data=[],this.compare=e||function(e,t){return e-t}}push(e){const t=this.data.length;this.data[t]=e,this.shiftUp(t)}peek(){return this.data[0]}pop(){if(this.data.length<=1)return this.data.shift();const e=this.data[0],t=this.data.pop();return void 0!==t&&e!==t?(this.data[0]=t,this.shiftDown(0),e):e}shiftUp(e){for(;e>0;){const t=e>>>1,i=this.data[t],r=this.data[e];if(!(this.compare(i,r)>0))return;s(this.data,e,t),e=t}}shiftDown(e){const t=this.data.length,i=(t>>>1)-1;for(;e<=i;){const i=2*(e+1)-1,r=i+1,o=this.data[e],n=this.data[i],a=this.data[r];if(this.compare(o,n)>0)r<t&&this.compare(n,a)>0?(s(this.data,e,r),e=r):(s(this.data,e,i),e=i);else{if(!(r<t&&this.compare(o,a)>0))return;s(this.data,e,r),e=r}}}show(){const e=this.data;return e&&0!==e.length?function t(i,s,r){if(i>=e.length||null===e[i]||void 0===e[i])return"";const o=e[i],n=2*i+1;let a="";return a+=t(2*i+2,s+1,r+6),a+=" ".repeat(r)+o+"\n",a+=t(n,s+1,r+6),a}(0,0,0):""}toString=this.show;toJSON=this.show;valueOf=this.show}function s(e,t,i){const s=e[t];e[t]=e[i],e[i]=s}const r=(e,t)=>{const i=e.expirationTime-t.expirationTime;return 0!==i?i:e.id-t.id};var o;!function(e){e.IMMEDIATE_PRIORITY="IMMEDIATE_PRIORITY",e.USER_BLOCKING_PRIORITY="USER_BLOCKING_PRIORITY",e.NORMAL_PRIORITY="NORMAL_PRIORITY",e.LOW_PRIORITY="LOW_PRIORITY",e.IDLE_PRIORITY="IDLE_PRIORITY"}(o||(o={}));const n={[o.IMMEDIATE_PRIORITY]:-1,[o.USER_BLOCKING_PRIORITY]:250,[o.NORMAL_PRIORITY]:500,[o.LOW_PRIORITY]:1e3,[o.IDLE_PRIORITY]:Number.MAX_SAFE_INTEGER},a=new class{taskQueue=new i(r);timerQueue=new i(r);userTaskCnt=0;isMessageLoopRunning=!1;isHostCallbackScheduled=!1;isPerformingWork=!1;isHostTimeoutScheduled=!1;timerId=void 0;startTime=-1;currentPriorityLevel=o.NORMAL_PRIORITY;scheduleCallback(e=o.NORMAL_PRIORITY,t=()=>{},i=0){const s=performance.now(),r=s+i,a=r+(n[e]||n[o.NORMAL_PRIORITY]),h={id:this.userTaskCnt++,priorityLevel:e,startTime:r,expirationTime:a,callback:t,sortIndex:-1};return r>s?(h.sortIndex=r,this.timerQueue.push(h),this.timerQueue.peek()===h&&(this.cancelHostTimeout(),this.requestHostTimeout(this.handleTimeout,h.startTime-performance.now()))):(h.sortIndex=a,this.taskQueue.push(h),this.isHostCallbackScheduled||this.isPerformingWork||(this.isHostCallbackScheduled=!0,this.requestHostCallback())),h}cancelCallback(e){e.callback=null}requestHostCallback(){this.isMessageLoopRunning||(this.isMessageLoopRunning=!0,this.schedulePerformWorkUntilDeadline())}advanceTimers(){let e=this.timerQueue.peek();for(;e;){if("function"!=typeof e.callback)this.taskQueue.pop();else{const t=performance.now();if(!(e.expirationTime<t))return;this.timerQueue.pop(),e.sortIndex=e.expirationTime,this.taskQueue.push(e)}e=this.timerQueue.peek()}}handleTimeout(){if(this.isHostTimeoutScheduled=!1,this.advanceTimers(),!this.isHostTimeoutScheduled)if(this.taskQueue.peek())this.isHostTimeoutScheduled=!0,this.requestHostCallback();else{const e=this.timerQueue.peek();e&&this.requestHostTimeout(this.handleTimeout,e.startTime-performance.now())}}requestHostTimeout(e,t){this.isHostTimeoutScheduled||(this.isHostTimeoutScheduled=!0,this.timerId=setTimeout(e,t))}cancelHostTimeout(){this.isHostTimeoutScheduled&&(clearTimeout(this.timerId),this.timerId=void 0,this.isHostTimeoutScheduled=!1)}performWorkUntilDeadline(){if(this.isMessageLoopRunning){const e=performance.now();this.startTime=e;let t=!0;try{t=this.flushWork(e)}finally{t?this.schedulePerformWorkUntilDeadline():this.isMessageLoopRunning=!1}}}schedulePerformWorkUntilDeadline(){if("function"==typeof MessageChannel){const e=new MessageChannel;e.port2.onmessage=this.performWorkUntilDeadline.bind(this),e.port1.postMessage(null)}else setTimeout((()=>{this.performWorkUntilDeadline()}))}flushWork(e){this.isHostCallbackScheduled=!1,this.cancelHostTimeout(),this.isPerformingWork=!0;const t=this.currentPriorityLevel;try{return this.workLoop(e)}finally{this.isPerformingWork=!1,this.currentPriorityLevel=t}}workLoop(e){let t=e;this.advanceTimers();let i=this.taskQueue.peek(),s=!1;for(;i&&(s=i.expirationTime<t,s||!this.shouldYieldToHost());){const e=i.callback;if("function"==typeof e){i.callback=null,this.currentPriorityLevel=i.priorityLevel;const t=e(s);if("function"==typeof t)return i.callback=t,this.advanceTimers(),!0;i===this.taskQueue.peek()&&this.taskQueue.pop(),this.advanceTimers()}else this.taskQueue.pop();i=this.taskQueue.peek()}if(i)return!0;if(this.timerQueue.peek()){const e=this.timerQueue.peek();e&&this.requestHostTimeout(this.handleTimeout,e.startTime-performance.now())}return!1}shouldYieldToHost(){return!(performance.now()-this.startTime<5)}getCurrentPriorityLevel(){return this.currentPriorityLevel}runWithPriority(e,t){const i=this.currentPriorityLevel;this.currentPriorityLevel=e;try{t()}catch(e){console.warn(e)}finally{this.currentPriorityLevel=i}}};var h=t.J,u=t.A;export{h as PriorityLevel,u as default};